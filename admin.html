<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Admin Panel - MultiCraft</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { background:#0f0f0f; color:white; font-family:Arial }
.card { background:#1b1b1b; padding:15px; margin:10px; border-radius:8px }
button { padding:6px 10px; margin:5px; cursor:pointer }
.ok { background:#00c853 }
.no { background:#d50000; color:white }
</style>
</head>

<body>
<h2>Painel Admin - Compras Pendentes</h2>
<div id="lista">Carregando...</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyASk1w8w6YzIQhkbJh7xv5BJb8ZHmG7MxM",
  authDomain: "multicraft-ea978.firebaseapp.com",
  databaseURL: "https://multicraft-ea978-default-rtdb.firebaseio.com",
  projectId: "multicraft-ea978",
  storageBucket: "multicraft-ea978.firebasestorage.app",
  messagingSenderId: "587079793250",
  appId: "1:587079793250:web:21d3fb74ae55eb6f5eef3b"
};

// ðŸ”’ impede reinicializaÃ§Ã£o
if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}

const db = firebase.database();

const webhookPublico = "https://discord.com/api/webhooks/1460447774993551380/nEe0VkGTtJufe23fLoEDqEf3ZrOslMHFDmftPZVY59SLtdiiYEvhxwZju4l-GsjUcCjL";

db.ref("compras").on("value", snap => {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  if (!snap.exists()) {
    lista.innerHTML = "Nenhuma compra pendente.";
    return;
  }

  snap.forEach(c => {
    const d = c.val();
    if (d.status !== "pendente") return;

    lista.innerHTML += `
      <div class="card">
        <b>Nick:</b> ${d.nick}<br>
        <b>Kit:</b> ${d.kit}<br><br>
        <button class="ok" onclick="confirmar('${c.key}','${d.nick}','${d.kit}')">Confirmar</button>
        <button class="no" onclick="negar('${c.key}')">Negar</button>
      </div>
    `;
  });
});

function confirmar(id,nick,kit){
  db.ref("compras/"+id).update({ status:"confirmado" });

  fetch(webhookPublico,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      embeds:[{
        title:"âœ… Compra confirmada",
        color:65280,
        fields:[
          {name:"Nick",value:nick,inline:true},
          {name:"Kit",value:kit,inline:true}
        ]
      }]
    })
  });
}

function negar(id){
  db.ref("compras/"+id).update({ status:"negado" });
}
</script>
</body>
</html>
