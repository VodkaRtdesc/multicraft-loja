<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { background:#111; color:white; font-family:Arial }
.card { background:#1c1c1c; padding:10px; margin:10px; border-radius:8px }
button { margin:5px; padding:5px 10px; cursor:pointer }
.ok { background:#00c853 }
.no { background:#d50000; color:white }
</style>
</head>

<body>
<h2>Painel Admin</h2>
<div id="lista"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyASk1w8w6YzIQhkbJh7xv5BJb8ZHmG7MxM",
  authDomain: "multicraft-ea978.firebaseapp.com",
  databaseURL: "https://multicraft-ea978-default-rtdb.firebaseio.com",
  projectId: "multicraft-ea978",
  storageBucket: "multicraft-ea978.firebasestorage.app",
  messagingSenderId: "587079793250",
  appId: "1:587079793250:web:21d3fb74ae55eb6f5eef3b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const webhookPublico = "https://discord.com/api/webhooks/1460447774993551380/nEe0VkGTtJufe23fLoEDqEf3ZrOslMHFDmftPZVY59SLtdiiYEvhxwZju4l-GsjUcCjL";

db.ref("compras").on("value", snap=>{
  const div = document.getElementById("lista");
  div.innerHTML = "";
  snap.forEach(c=>{
    const d = c.val();
    if(d.status !== "pendente") return;

    div.innerHTML += `
      <div class="card">
        <b>${d.nick}</b><br>
        ${d.kit}<br>
        <button class="ok" onclick="confirmar('${c.key}','${d.nick}','${d.kit}')">Confirmar</button>
        <button class="no" onclick="negar('${c.key}')">Negar</button>
      </div>`;
  });
});

function confirmar(id,nick,kit){
  db.ref("compras/"+id+"/status").set("confirmado");

  fetch(webhookPublico,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      embeds:[{
        title:"âœ… Compra confirmada",
        color:65280,
        fields:[
          {name:"Nick",value:nick,inline:true},
          {name:"Kit",value:kit,inline:true}
        ]
      }]
    })
  });
}

function negar(id){
  db.ref("compras/"+id+"/status").set("negado");
}
</script>
</body>
</html>
